---
layout: base.njk
---
<article class="note">
    <header class="note-header">
        <h1>{{ title }}</h1>
        {% if date %}
        <time datetime="{{ date }}">{{ date }}</time>
        {% endif %}
        {% if tags %}
        <div class="tags">
            {% for tag in tags %}
            <span class="tag">#{{ tag }}</span>
            {% endfor %}
        </div>
        {% endif %}
    </header>
    
    <div class="note-content">
        {{ content | safe }}
    </div>

    {# Videos (if any) #}
    {% set slug = page.fileSlug or (page.url | trim('/') | split('/') | last) %}
    {% set videos = video_index[slug] %}
    <!-- DEBUG: slug={{ slug }}, video-index-defined={{ (video_index is defined) }}, video-index-size={{ video_index | length }}, videos-defined={{ (video_index[slug] is defined) }} -->
    {% if videos %}
      <div class="note-videos">
        {% for v in videos %}
          {% set src = v.filename %}
          {% set poster = v.poster %}
          {% set caption = v.caption %}
          {% include "video_player.njk" %}
        {% endfor %}
      </div>
    {% endif %}
    
    <footer class="note-footer">
        <nav class="note-nav">
            <a href="/">返回首页</a>
            <a href="/notes/">所有笔记</a>
        </nav>
    </footer>
</article>